{% extends 'base.html' %}

{% block content %}

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css"> 
    <div class="container px-5">
        <p>
            <span style="color: red;">{{ request.GET.query }}</span> 
            의 검색 결과
        </p>
    </div>

    <div class="container px-5 mx-auto mt-20" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; ">
        {% for product in page_obj %}
            <div class="d-flex flex-column">
                <img src="{{ product.Pd_IMG }}" style="width: 100%; height: auto;" alt="Product Image">
                <p>{{ product.Pd_Name }}</p>
    
                <!-- wishlist 추가사항 -->
                    {% csrf_token %}
                    {{ form.as_p }}
                    {% if user.is_authenticated %}
                        <div class="d-flex justify-content-between">
                            <div style="font-weight: bold;">{{ product.Pd_Price }}원</div>
                            <!-- Button trigger modal -->
                            <button onclick="add(this.getAttribute('data-product-id'))" data-product-id="{{ product.Pd_IndexNumber }}" style="border: none; background-color: transparent; width:16px; height: 16px; display: inline-block; padding: 0;">
                                <i id="heart-{{ product.Pd_IndexNumber }}" class="bi-heart" style="font-size:16px; color: red; cursor: pointer;"></i>
                            </button>   
                        </div>

                    {% else %}
                        <p>Please <a href="{% url 'accounts_app:login' %}">login</a> to add to your wishlist.</p>
                    {% endif %}

            </div>
        {% empty %}
            <p>No results found.</p>
        {% endfor %}
    </div>

    <div class="container mt-5">
        <!-- <div class="row">
            <div class="col" style="text-align: center;">
            {% if page_obj.has_previous %}
                <a href="?query={{ request.GET.query }}&page=1" class="btn btn-outline-secondary">First</a>
                <a href="?query={{ request.GET.query }}&page={{ page_obj.previous_page_number }}" class="btn btn-outline-secondary">Previous</a>
            {% endif %}
            </div>
            <div class="col-6" style="text-align: center;">
                <span class="mx-auto">{{page_obj.number}} of {{page_obj.paginator.num_pages}}</span>
            </div>
            <div class="col" style="text-align: center;">
                {% if page_obj.has_next %}
                    <a href="?query={{ request.GET.query }}&page={{ page_obj.next_page_number }}" class="btn btn-outline-secondary">Next</a>
                    <a href="?query={{ request.GET.query }}&page={{page_obj.paginator.num_pages}}" class="btn btn-outline-secondary">Last</a>
                {% endif %}
            </div>
        </div> -->
        {% if page_obj.has_other_pages %}
            <ul class="pagination justify-content-center">
                {% if page_obj.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?query={{ request.GET.query }}&page={{page_obj.previous_page_number}}">&#10094;</a>
                </li>
                {% endif %}

                {% for page in paginator.page_range %}
                {% if page_start_number <= page and page_end_number >= page %}
                    {% if page == page_obj.number %}
                    <li class="page-item active">
                        <a class="page-link" href="#">{{page}}</a>
                    </li>
                    {% else %}
                    <li class="page-item">
                        <a class="page-link" href="?query={{ request.GET.query }}&page={{page}}">{{page}}</a>
                    </li>
                    {% endif %}
                {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?query={{ request.GET.query }}&page={{page_obj.next_page_number}}">&#10095;</a>
                </li>
                {% endif %}
            </ul>
        {% endif %}
    </div>

    <script>
        function add(Pd_IndexNumber) {
            $.ajax({
                url: "/accounts/add_to_wishlist/" + Pd_IndexNumber,
                dataType: "json",
                success: function(response) {
                    var alreadyWishlist = response.already_wishlist;
                    // 하트 아이콘의 클래스를 변경
                    if (alreadyWishlist) {
                        $('#heart-' + Pd_IndexNumber).attr('class','bi-heart-fill');
                    } else {
                        $('#heart-' + Pd_IndexNumber).attr('class','bi-heart');
                    }
                    
                    // 메시지 출력
                    alert(response.message);
                }
            })
        };
    </script>
{% endblock %}
