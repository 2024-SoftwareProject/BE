{% extends 'base.html' %}

{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Range Slider Example</title>

<style>
.slider-container {
    display: inline-block;
    margin: 5px;
}

.slider {
    -webkit-appearance: none;
    width: 700px;
    height: 10px;
    border-radius: 5px;
    background: #d3d3d3;
    outline: none;
    opacity: 0.7;
    -webkit-transition: .2s;
    transition: opacity .2s;
}

.slider:hover {
    opacity: 1;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #000080;
    cursor: pointer;
}

.slider::-ha-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #000080;
    cursor: pointer;
}

button {
    display: inline-block;
    margin-left: 10px;
    vertical-align: middle;
}
</style>
</head>

<body>

    
<div class="container px-5"></div>
<p> <span id="queryValueDisplay"></span> 을(를) <span id="minValueDisplay"></span>부터 "<span id="maxValueDisplay"></span>"까지 "<span id="sortValueDisplay"></span>" 방식으로 찾아본 결과입니다.</p>
</div>


<p id="error" style="color: red; display: none;">정확한 범위를 지정해 주세요!</p>

<div class="slider-container">
    <input type="range" min="0" max="3000000" value="0" class="slider" step="1000" id="minSlider">
    <p> 최솟값 : <span id="minValue"></span> </p>
</div>

<div class="slider-container">
    <input type="range" min="0" max="3000000" value="3000000" class="slider" step="1000" id="maxSlider">
    <p> 최댓값 : <span id="maxValue"></span> </p>
</div>

<div style="display: inline-block; padding-right: 130px;">
    <input type="checkbox" name="sort" value="latest" onclick="updateSortOption(this)"> 최신순
    <input type="checkbox" name="sort" value="popularity" onclick="updateSortOption(this)"> 인기순
    <input type="checkbox" name="sort" value="price_low" onclick="updateSortOption(this)"> 가격 낮은순
    <input type="checkbox" name="sort" value="price_high" onclick="updateSortOption(this)"> 가격 높은순

    <form id="searchForm" onsubmit="make_report(); return false;">
        <p><input type="submit" value="Submit"></p>
    </form>

</div>



    <script>
        var query = get_url_parameter('query');
        var minSlider = document.getElementById("minSlider");
        var maxSlider = document.getElementById("maxSlider");
        var minOutput = document.getElementById("minValue");
        var maxOutput = document.getElementById("maxValue");
        var errorElement = document.getElementById("error");
        var min = 0;
        var max = 3000000;
        var sort = "latest"; 
        var page_point = 1;
        
        minOutput.innerHTML = addCommas(minSlider.value);
        maxOutput.innerHTML = addCommas(maxSlider.value);

        window.onload = function() {
            optionDisplay();
            updateMinOption();
            updateMaxOption();
        };
        
        minSlider.oninput = function() {
        minOutput.innerHTML = addCommas(this.value);
        checkRange();
        updateMinOption();
        }
        
        maxSlider.oninput = function() {
        maxOutput.innerHTML = addCommas(this.value);
        checkRange();
        updateMaxOption()
        
        }
        
        function addCommas(value) {
        return value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + '원';
        }
        
        function checkRange() {
        if (parseInt(minSlider.value) >= parseInt(maxSlider.value)) {
            errorElement.style.display = 'block';
        } else {
            errorElement.style.display = 'none';
        }
        }
        
        function make_report() {
            query = get_url_parameter('query');
            var newUrl = '/search/report?query=' + query + '&sort=' + sort + '&min=' + min + '&max=' + max + '&page=' + page_point;
            optionDisplay();
            window.location.href = newUrl; 
        }

        function get_url_parameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        function updateSortOption(checkbox) {
            if (checkbox.checked) {
                sort = checkbox.value;

            } else {
                sort = 'latest';
            }
        }

        function updateMinOption() {
            min = minSlider.value
        }
        function updateMaxOption() {
            max = maxSlider.value
        
        }

        function goToPage(page) 
        {   
            query = get_all_url_parameter('query');
            sort = get_all_url_parameter('sort');
            min = get_all_url_parameter('min');
            max = get_all_url_parameter('max');

            page_point = page;
            make_report();

        }
        
        function optionDisplay() {
            query = get_all_url_parameter('query');
            min = get_all_url_parameter('min');
            max = get_all_url_parameter('max')
            sort = get_all_url_parameter('sort');

            document.getElementById("queryValueDisplay").innerText = query;
            document.getElementById("minValueDisplay").innerText = addCommas(min);
            document.getElementById("maxValueDisplay").innerText = addCommas(max);
            document.getElementById("sortValueDisplay").innerText = sort;
        }

        function get_all_url_parameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

        function add(Pd_IndexNumber) {
            $.ajax({
                url: "/accounts/add_to_wishlist/" + Pd_IndexNumber,
                dataType: "json",
                success: function(response) {
                    var alreadyWishlist = response.already_wishlist;
                    // 하트 아이콘의 클래스를 변경
                    if (alreadyWishlist) {
                        $('#heart-' + Pd_IndexNumber).attr('class','bi-heart-fill');
                    } else {
                        $('#heart-' + Pd_IndexNumber).attr('class','bi-heart');
                    }

                    // 메시지 출력
                    alert(response.message);
                }
            })
        };

        const inputLeft = document.getElementById("minSlider");
        const inputRight = document.getElementById("maxSlider");

        const thumbLeft = document.querySelector(".slider > .thumb.left");
        const thumbRight = document.querySelector(".slider > .thumb.right");
        const range = document.querySelector(".slider > .range");

        const setLeftValue = () => {
        const _this = inputLeft;
        const [min, max] = [parseInt(_this.min), parseInt(_this.max)];
        // 교차되지 않게, 1을 빼준 건 완전히 겹치기보다는 어느 정도 간격을 남겨두기 위해.
        _this.value = Math.min(parseInt(_this.value), parseInt(inputRight.value) - 1);
        // input, thumb 같이 움직이도록
        const percent = ((_this.value - min) / (max - min)) * 100;
        thumbLeft.style.left = percent + "%";
        range.style.left = percent + "%";
        };

        const setRightValue = () => {
        const _this = inputRight;
        const [min, max] = [parseInt(_this.min), parseInt(_this.max)];
        // 교차되지 않게
        _this.value = Math.max(parseInt(_this.value), parseInt(inputLeft.value) + 1);
        // input, thumb 같이 움직이도록
        const percent = ((_this.value - min) / (max - min)) * 100;
        thumbRight.style.right = 100 - percent + "%";
        range.style.right = 100 - percent + "%";
        };

        inputLeft.addEventListener("input", setLeftValue);
        inputRight.addEventListener("input", setRightValue);
</script>
</body>
</html>

{% endblock %}